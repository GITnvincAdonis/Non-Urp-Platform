// Each #kernel tells which function to compile; you can have many kernels
#pragma kernel CSMain
#include "Simplex.compute"
// Create a RenderTexture with enableRandomWrite flag and set it
// with cs.SetTexture

struct GrassData
{
    float3 Position;
    float3 Rotation;
    float Scale;
};

RWStructuredBuffer<GrassData> positionBuffer;
RWTexture2D<float4> Result;
int _Dimension,_scale,_maxScale,_minScale;
float _heightNoiseScale;


[numthreads(8,8,1)]
void CSMain (uint3 id : SV_DispatchThreadID)
{
    // TODO: insert actual code here!
    if (id.x < uint(_Dimension) && id.y < uint(_Dimension))
    {
        GrassData tempStruct;
        float3 position = 0.0f;
    
        position.xz = (id.xy - float(_Dimension) * 0.5) * (2.0f / float(_scale));
        position.x += snoise(float3(position.xz, 0.0f) * 15.0f) * 10;
        position.z += snoise(float3(position.xz, 0.0f) * 10.0f) * 4;
        
        
        float localYRot = snoise(float3(position.xz, 40) * 50.0f) * 500.0f;
        tempStruct.Position = position;
        tempStruct.Rotation = float3(1, -1 * localYRot, 1.0f);
        float variedScale = snoise(float3(position.xz, 0.0f) * _heightNoiseScale);
        tempStruct.Scale = max(variedScale * _maxScale , _minScale );
        positionBuffer[id.x + id.y * _Dimension] = tempStruct;
    }
    
    
}
